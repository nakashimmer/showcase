<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>JS + PHP TTS</title>
</head>
<body>
    <h1>テキストを音声ファイルに変換</h1>
    <textarea id="textToSpeak" rows="4" cols="50">
        ここにテキストを入力してください。
    </textarea><br>
    <button onclick="generateAudio()">音声ファイルを生成</button>
    <div id="status"></div>
    <a id="downloadLink" style="display:none;">音声ファイルをダウンロード</a>

    <script>
        async function generateAudio() {
            const text = document.getElementById('textToSpeak').value;
            const statusDiv = document.getElementById('status');
            const downloadLink = document.getElementById('downloadLink');

            statusDiv.textContent = '生成中...';
            downloadLink.style.display = 'none';

            const formData = new FormData();
            formData.append('text', text);

            try {
                const response = await fetch('generate_audio.php', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    statusDiv.textContent = '生成完了！';
                    downloadLink.href = result.file;
                    downloadLink.download = 'generated_audio.mp3'; // ダウンロード時のファイル名
                    downloadLink.style.display = 'block';
                } else {
                    statusDiv.textContent = 'エラー: ' + result.message;
                    console.error(result.details);
                }
            } catch (error) {
                statusDiv.textContent = '通信エラーが発生しました。';
                console.error(error);
            }
        }
    </script>
</body>
</html>